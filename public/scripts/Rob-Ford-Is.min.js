/*! Rob-Ford-Is  v0.0.8 - 2014-06-07 */
"use strict";function pushId(id){keepArrayFresh.apply(viewedIds,[id,.9*quotesLimit])}function keepArrayFresh(id,limit){limit=limit||2,-1===this.indexOf(id)&&this.push(id),this.length>limit&&this.splice(0,1)}function parseLocation(){return{href:window.location.href,pathname:window.location.pathname}}function randomBoolean(){return Math.random()>=.5?!0:!1}function randomInt(min,max){return min?min:min=0,max?max:max=1,0|Math.random()*(max-min+1)+min}function randomFloat(min,max){return min?min:min=0,max?max:max=1,Math.random()*(max-min+1)+min}function getNewRandom(min,max,current){var newRandom=randomInt(min,max);return newRandom!==current?newRandom:getNewRandom(min,max,current)}function recursiveCheckForElement(element,tag){return element&&element.tagName?element.tagName.toLowerCase()===tag?element:recursiveCheckForElement(element.parentNode,tag):!1}function createQuoteElm(quote){pushId(quote._id);var quoteElm=document.createElement("article"),text=document.createElement("h1"),link=document.createElement("a"),footer=document.createElement("footer"),cite=document.createElement("cite"),time=document.createElement("time"),moreLink=document.createElement("a"),paragraph=document.createElement("p");quote.date&&time.setAttribute("datetime",quote.date),time.textContent=quote.date?" on "+moment(quote.date).zone("05:00").format("LL").toString():"",cite.innerHTML=quote.who?"&mdash;"+quote.who:"",quote.date&&cite.appendChild(time),moreLink.href="/random",moreLink.addEventListener("click",function(event){return event.preventDefault(),loadQuote(null),!1});var moreTextOptions=["Who else is he?","He's who?","Crazy. What else?","Is that all?","More, more!","That can't be right.","That's just stupid","You're kidding","Is that really him?","What else ya got?","Rob Ford is who now?","Uhhh who?","Who is he, again?","Any more?","Gimme another"],moreText=moreTextOptions.filter(function(string){return-1===moreTextUsed.indexOf(string)}).sort(function(){return.5-Math.random()})[0];keepArrayFresh.apply(moreTextUsed,[moreText,moreTextOptions.length-1]),moreLink.textContent=moreText;var citation=paragraph.cloneNode(!1);citation.appendChild(cite),footer.appendChild(citation),moreLink.classList.add("button"),moreLink.classList.add("more");var more=document.createElement("div");return more.appendChild(moreLink),footer.appendChild(more),link.href=quote.link,link.target="_blank",link.textContent=quote.text,text.appendChild(link),text.title=quote.altText,quoteElm.appendChild(text),quoteElm.appendChild(footer),quoteElm.classList.add("quote"),quoteElm.classList.add("container"),quoteElm}function populateQuote(quote){var contentElm=document.getElementById("content"),oldQuoteElm=contentElm.querySelector("article.quote"),quoteElm=createQuoteElm(quote);quoteElm.classList.add("new"),contentElm.appendChild(quoteElm),quoteElm.clientHeight,quoteElm.classList.remove("new"),oldQuoteElm.parentNode.removeChild(oldQuoteElm)}function loadQuote(url){var cacheBreaker=new Date;cacheBreaker=cacheBreaker.getTime(),url=url?url+"?r="+cacheBreaker:"/random?not="+viewedIds.join(","),internalReq=new XMLHttpRequest,internalReq.open("GET",url),internalReq.timeout=1e4,internalReq.setRequestHeader("Content-Type","application/json"),internalReq.setRequestHeader("accept","application/json"),internalReq.setRequestHeader("X-Requested-With","XMLHttpRequest");var mainElm=document.getElementById("main"),contentElm=document.getElementById("content");contentElm.querySelector("article.quote"),mainElm.classList.add("loading"),internalReq.onload=function(){var quote;switch(internalReq.status){case 200:quote=JSON.parse(internalReq.responseText),populateQuote(quote),history.pushState&&history.pushState({quote:quote},"Rob Ford is: "+quote.text,"/"+quote.slug),document.title="Rob Ford is: "+quote.text,window.ga&&ga("send","pageview",{page:"/"+quote.slug,title:document.title}),internalReqFailures=0;break;default:console.log("Could not load quote "+url+" . Status:"+internalReq.status),2>internalReqFailures&&loadQuote("/random"),internalReqFailures++}mainElm.classList.remove("loading")},internalReq.onerror=function(event){event.preventDefault(),console.log(internalReq)},internalReq.onabort=function(){},internalReq.ontimeout=function(){},internalReq.onprogress=function(){},internalReq.send(null)}var mainElm,internalReq,internalReqFailures=0,currentLocation=parseLocation(),initialLoad=!1,viewedIds=[],moreTextUsed=[],quotesLimit=0;window.onpopstate=function(event){event.preventDefault(),"state"in window.history&&null!==event.state&&null!==event.state.quote&&initialLoad&&populateQuote(event.state.quote),initialLoad||(initialLoad=!0)},function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}(),document.addEventListener("DOMContentLoaded",function(){mainElm=document.querySelector("main"),mainElm.classList.add("loading-initial")}),window.onload=function(){setTimeout(function(){mainElm.classList.remove("loading-initial")},500);var loadQuoteElm=document.getElementById("load-quote");if(loadQuoteElm){var toLoadId=loadQuoteElm.getAttribute("data-quote-id");loadQuote(toLoadId?"/"+toLoadId:null)}quotesLimit="undefined"!=typeof limit?limit:0;var overlayTrigger=document.getElementById("overlay-trigger");overlayTrigger&&(overlayTrigger.onclick=function(event){event.preventDefault(),document.body.classList.toggle("show-overlay")})};